// Poker Tracker Pro - Database Schema
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Poker Group - represents a poker group (e.g., "Friday Night Poker")
model Group {
  id           String   @id @default(cuid())
  name         String
  defaultBuyIn Float    @default(5.0)
  currency     String   @default("USD")
  userRole     String   @default("EDITOR") // "VIEWER" | "EDITOR"
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  players   Player[]
  sessions  Session[]
  templates SessionTemplate[]

  @@map("groups")
}

// Player - members of a poker group
model Player {
  id        String   @id @default(cuid())
  groupId   String
  name      String
  avatarUrl String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  group   Group          @relation(fields: [groupId], references: [id], onDelete: Cascade)
  entries SessionEntry[]
  notes   PlayerNote[]

  @@unique([groupId, name])
  @@index([groupId])
  @@index([groupId, isActive])
  @@map("players")
}

// Session - represents a poker night/game
model Session {
  id          String    @id @default(cuid())
  groupId     String
  date        DateTime
  startTime   String? // e.g., "19:30"
  endTime     String? // e.g., "23:45"
  location    String?
  notes       String?
  photoUrls   String? // JSON array of URLs
  status      String    @default("COMPLETED") // "IN_PROGRESS" | "COMPLETED"
  settlements String? // JSON array: [{ from, to, amount }]
  deletedAt   DateTime? // Soft delete timestamp
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  group   Group          @relation(fields: [groupId], references: [id], onDelete: Cascade)
  entries SessionEntry[]

  @@index([groupId, date])
  @@index([groupId, status])
  @@map("sessions")
}

// SessionEntry - individual player results for a session
model SessionEntry {
  id        String   @id @default(cuid())
  sessionId String
  playerId  String
  buyIn     Float // Total buy-in amount (including rebuys)
  cashOut   Float // Cash-out amount
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  session Session @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  player  Player  @relation(fields: [playerId], references: [id], onDelete: Cascade)

  // Calculated fields (not stored, computed on query):
  // profit = cashOut - buyIn
  // rebuys = (buyIn - defaultBuyIn) / defaultBuyIn

  @@unique([sessionId, playerId])
  @@index([sessionId])
  @@index([playerId])
  @@map("session_entries")
}

// PlayerNote - notes about players (tendencies, strategies)
model PlayerNote {
  id        String   @id @default(cuid())
  playerId  String
  note      String
  tags      String? // JSON array of tags
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@map("player_notes")
}

// SessionTemplate - saved session configurations for quick entry
model SessionTemplate {
  id          String   @id @default(cuid())
  groupId     String
  name        String // e.g., "Thursday Night Poker"
  location    String?
  defaultTime String? // e.g., "19:30"
  playerIds   String // JSON array of player IDs
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  group Group @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([groupId])
  @@map("session_templates")
}
